"use strict";(self["webpackChunkDive"]=self["webpackChunkDive"]||[]).push([[283],{8283:function(e,t,o){o.r(t),o.d(t,{default:function(){return O}});var n=o(3396),a=o(7139);const l={class:"text-end"},s={class:"table mt-4 container"},i=(0,n._)("thead",null,[(0,n._)("tr",null,[(0,n._)("th",{width:"140"},"折扣名稱(代碼)"),(0,n._)("th",null,"折數"),(0,n._)("th",null,"期限"),(0,n._)("th",null,"開啟"),(0,n._)("th",{width:"200"},"編輯")])],-1),d={class:"text-success"},u={class:"btn-group"},p=["onClick"],c=["onClick"];function m(e,t,o,m,r,h){const _=(0,n.up)("LoadingView"),b=(0,n.up)("CouponModal"),g=(0,n.up)("DeleteModal");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(_,{active:r.isLoading},null,8,["active"]),(0,n._)("div",l,[(0,n._)("button",{class:"btn btn-titleblue col-2",onClick:t[0]||(t[0]=e=>h.openModal(!0))},"新增折扣")]),(0,n._)("table",s,[i,(0,n._)("tbody",null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(r.coupons,((t,o,l)=>((0,n.wg)(),(0,n.iD)("tr",{key:l},[(0,n._)("td",null,(0,a.zw)(t.title+`(${t.code})`),1),(0,n._)("td",null,(0,a.zw)(t.percent),1),(0,n._)("td",null,(0,a.zw)(e.$filters.date(t.due_date)),1),(0,n._)("td",null,[(0,n._)("span",d,(0,a.zw)(1===t.is_enabled?"生效":"失效"),1)]),(0,n._)("td",null,[(0,n._)("div",u,[(0,n._)("button",{class:"btn btn-outline-primary btn-sm",onClick:e=>h.openModal(!1,t)}," 編輯 ",8,p),(0,n._)("button",{class:"btn btn-outline-danger btn-sm",onClick:e=>h.deleteModal(t)},"刪除",8,c)])])])))),128))])]),(0,n.Wm)(b,{coupon:r.coupontemp,onUpdateCoupon:h.updateCoupon,ref:"CouponModal"},null,8,["coupon","onUpdateCoupon"]),(0,n.Wm)(g,{product:r.coupontemp,onDelItem:h.delitem,ref:"DeleteModal"},null,8,["product","onDelItem"])],64)}var r=o(9242);const h={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},_={class:"modal-dialog",role:"document"},b={class:"modal-content"},g=(0,n._)("div",{class:"modal-header"},[(0,n._)("h5",{class:"modal-title",id:"exampleModalLabel"},"優惠券"),(0,n._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),C={class:"modal-body"},v={class:"mb-3"},f={for:"title"},w={class:"mb-3"},y={for:"coupon_code"},M={class:"mb-3"},k={for:"due_date"},D={class:"mb-3"},$={for:"price"},x={class:"mb-3"},U={class:"form-check"},L={class:"form-check-label",for:"is_enabled"},V={class:"modal-footer"},z=(0,n._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close",-1);function Z(e,t,o,a,l,s){return(0,n.wg)(),(0,n.iD)("div",h,[(0,n._)("div",_,[(0,n._)("div",b,[g,(0,n._)("div",C,[(0,n._)("div",v,[(0,n._)("label",f,[(0,n.Uk)("標題"),(0,n.wy)((0,n._)("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[0]||(t[0]=e=>l.tempCoupon.title=e),placeholder:"請輸入標題"},null,512),[[r.nr,l.tempCoupon.title]])])]),(0,n._)("div",w,[(0,n._)("label",y,[(0,n.Uk)("優惠碼 "),(0,n.wy)((0,n._)("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":t[1]||(t[1]=e=>l.tempCoupon.code=e),placeholder:"請輸入優惠碼"},null,512),[[r.nr,l.tempCoupon.code]])])]),(0,n._)("div",M,[(0,n._)("label",k,[(0,n.Uk)("到期日"),(0,n.wy)((0,n._)("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":t[2]||(t[2]=e=>l.due_date=e)},null,512),[[r.nr,l.due_date]])])]),(0,n._)("div",D,[(0,n._)("label",$,[(0,n.Uk)("折扣百分比"),(0,n.wy)((0,n._)("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":t[3]||(t[3]=e=>l.tempCoupon.percent=e),placeholder:"請輸入折扣百分比"},null,512),[[r.nr,l.tempCoupon.percent,void 0,{number:!0}]])])]),(0,n._)("div",x,[(0,n._)("div",U,[(0,n._)("label",L,[(0,n.Uk)(" 是否啟用 "),(0,n.wy)((0,n._)("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[4]||(t[4]=e=>l.tempCoupon.is_enabled=e),id:"is_enabled"},null,512),[[r.e8,l.tempCoupon.is_enabled]])])])])]),(0,n._)("div",V,[z,(0,n._)("button",{type:"button",class:"btn btn-primary",onClick:t[5]||(t[5]=t=>e.$emit("update-coupon",l.tempCoupon))}," 更新優惠券 ")])])])],512)}var I=o(3618),N={name:"couponModal",props:{coupon:{}},data(){return{tempCoupon:{},due_date:""}},emits:["update-coupon"],watch:{coupon(){if(this.tempCoupon=this.coupon,this.tempCoupon.due_date){const e=new Date(1e3*this.tempCoupon.due_date).toISOString().split("T");[this.due_date]=e}},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},mixins:[I.Z]},W=o(89);const j=(0,W.Z)(N,[["render",Z]]);var H=j,S=o(4024),Y={data(){return{coupons:[],coupontemp:{},isNew:!1,isLoading:!1}},components:{CouponModal:H,DeleteModal:S.Z},methods:{openModal(e,t){this.coupontemp=e?{}:{...t},this.isNew=e;const o=this.$refs.CouponModal;o.showModal()},deleteModal(e){this.coupontemp={...e};const t=this.$refs.DeleteModal;t.showModal()},delitem(e){this.isLoading=!0,this.coupontemp=e;const t=`https://vue3-course-api.hexschool.io/api/waynechendive-api/admin/coupon/${e.id}`;this.$http.delete(t).then((e=>{this.isLoading=!1;const t=this.$refs.DeleteModal;this.getCoupons(),t.hideModal(),this.emitter.emit("push-msg",{style:"danger",title:e.data.message,content:e.data.message})})).catch((e=>{console.log(e)}))},updateCoupon(e){this.isLoading=!0,this.coupontemp=e;const t=this.$refs.CouponModal;let o="https://vue3-course-api.hexschool.io/api/waynechendive-api/admin/coupon",n="post";this.isNew||(o=`https://vue3-course-api.hexschool.io/api/waynechendive-api/admin/coupon/${e.id}`,n="put"),t.hideModal(),this.$http[n](o,{data:this.coupontemp}).then((e=>{this.isLoading=!1,console.log(e.data.message),e.data.success?(this.getCoupons(),this.$emitter.emit("push-msg",{style:"success",title:e.data.message,content:e.data.message})):this.$emitter.emit("push-msg",{style:"warning",title:"更新失敗",content:e.data.message.join(",")})}))},getCoupons(){this.isLoading=!0;const e="https://vue3-course-api.hexschool.io/api/waynechendive-api/admin/coupons";this.$http.get(e).then((e=>{this.coupons=e.data.coupons,this.isLoading=!1})).catch((e=>{console.log(e)}))}},inject:["emitter"],created(){this.getCoupons()}};const K=(0,W.Z)(Y,[["render",m]]);var O=K}}]);
//# sourceMappingURL=283.f18a6716.js.map